target desktop {
	env /system/boot/SetupEnvironment

	service x-vnd.Be-TRAK {
		launch /system/Tracker
		legacy
		on {
			initial_volumes_mounted
		}
	}

	service x-vnd.Be-TSKB {
		launch /system/Deskbar
		on {
			initial_volumes_mounted
		}
	}

	job user-bootscript {
		launch /bin/sh ~/config/settings/boot/UserBootscript
	}

	job first-login {
		launch /bin/sh /system/boot/PostInstallScript "first login" ~/config/settings/first_login /boot/system/boot/first-login
		if file_exists ~/config/settings/first_login
	}

	job create-installer-link {
		# When run from a read-only medium a.k.a. live desktop
		if {
			read_only
			file_exists /boot/system/apps/Installer
		}
		launch /bin/ln -sf /boot/system/apps/Installer ~/Desktop/Installer
	}
}

target first_boot {
	job x-vnd.Haiku-FirstBootPrompt
}

target installer {
	job x-vnd.Haiku-Installer
}

run {
	if {
		file_exists /system/bin/FirstBootPrompt
		or {
			not file_exists /boot/home/config/settings/Locale\ settings
			read_only
		}
	}
	then {
		first_boot
	}
	else {
		desktop
	}
}
